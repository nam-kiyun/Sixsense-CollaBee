<?xml version="1.0" encoding="UTF-8"?>
<?xml-stylesheet href="/InsWebApp/css/auth/base.css" type="text/css"?>
<?xml-stylesheet href="/InsWebApp/css/auth/loginPage.css" type="text/css"?>
<html xmlns="http://www.w3.org/1999/xhtml"
    xmlns:ev="http://www.w3.org/2001/xml-events"
    xmlns:w2="http://www.inswave.com/websquare" xmlns:xf="http://www.w3.org/2002/xforms">
    <head>
    	<w2:type>COMPONENT</w2:type>
    	<w2:buildDate />
    	<w2:MSA />
    	<xf:model>
    		<w2:dataCollection baseNode="map">
    			<w2:dataMap baseNode="map" id="dma_login">
    				<w2:keyInfo>
    					<w2:key dataType="text" name="아이디" id="id"></w2:key>
    					<w2:key dataType="text" name="비밀번호" id="password"></w2:key>
    				</w2:keyInfo>
    			</w2:dataMap>
    			<w2:dataMap baseNode="map" id="dma_mailParam">
    				<w2:keyInfo>
    					<w2:key dataType="text" name="이메일" id="email"></w2:key>
    				</w2:keyInfo>
    			</w2:dataMap>
    			<w2:dataMap baseNode="map" id="dma_recaptcha">
    				<w2:keyInfo>
    					<w2:key dataType="text" name="비밀키" id="secretKey"></w2:key>
    					<w2:key dataType="text" name="토큰" id="token"></w2:key>
    				</w2:keyInfo>
    			</w2:dataMap>
    		</w2:dataCollection>
    		<w2:workflowCollection />
    		<xf:submission id="sbm_login" action="/InsWebApp/UserLogin.pwkjson" method="post" mediatype="application/json"
    			ref='data:json,{"id":"dma_login","key":"elData"}' target="" encoding="UTF-8" instance="" replace="" errorHandler="" customHandler=""
    			mode="asynchronous" processMsg="" ev:submit="" ev:submitdone="scwin.sbm_login_submitdone" ev:submiterror="" abortTrigger="">
    		</xf:submission>
    		<xf:submission id="sbm_email" action="/InsWebApp/SendEmail.pwkjson" method="post" mediatype="application/json" ref="" target=""
    			encoding="UTF-8" instance="" replace="" errorHandler="" customHandler="" mode="asynchronous" processMsg="" ev:submit=""
    			ev:submitdone="" ev:submiterror="" abortTrigger="">
    		</xf:submission>
    		<xf:submission id="sbm_recaptcha" action="/InsWebApp/verifyRecaptcha.pwkjson" method="post" mediatype="application/json" ref='data:json,{"id":"dma_recaptcha","key":"elData"}' target="" encoding="UTF-8"
    			instance="" replace="" errorHandler="" customHandler="" mode="asynchronous" processMsg="" ev:submit="" ev:submitdone="scwin.sbm_rechapcher_submitdone"
    			ev:submiterror="scwin.sbm_recaptcha_submiterror" abortTrigger="">
    		</xf:submission>
    	</xf:model>
    	<w2:layoutInfo />
    	<w2:publicInfo method="" />
    	<script lazy="false" type="text/javascript"><![CDATA[scwin.onpageload = function () {
    scwin.onresize();

    let recaptchaComponent = $p.getComponentById("recaptcha-container");

    if (recaptchaComponent !== null && typeof grecaptcha !== "undefined") {

        let actualDomId = recaptchaComponent.id;
        grecaptcha.ready(function () {

            grecaptcha.render(actualDomId, {
                sitekey: "6LdornErAAAAAD-oky4HtvcskvmYnoLi_i4Dc2f3",
            });
            $p.log("reCAPTCHA 렌더링 요청 완료: " + actualDomId); // 로그 추가 [190, 16.1.1]
        });

    } else {
        if (recaptchaComponent === null) {
            $p.log("Error: 'recaptcha-container' 컴포넌트를 찾을 수 없습니다. ID를 확인하세요."); // 로그 추가 [190, 16.1.1]
        }
        if (typeof grecaptcha === "undefined") {
            $p.log("Error: grecaptcha API를 찾을 수 없거나 준비되지 않았습니다. reCAPTCHA 스크립트 로딩을 확인하세요."); // 로그 추가 [190, 16.1.1]
        }
    }
};

scwin.onresize = function (e) {
    // resize 이벤트 정의
    window.onresize = function () {
        scwin.applyResponsiveWidth();
    };

    // 페이지 로딩 시에도 한 번 실행
    scwin.applyResponsiveWidth();
};

//반응형 width 값 조절
scwin.applyResponsiveWidth = function () {
    let width = window.innerWidth;

    if (width <= 650) {
        signup_form.setStyle("width", "100%");
        signup_group.setStyle("width", "80%");
        login_button.setStyle("width", "80%");
    } else if (width <= 1300) {
        signup_form.setStyle("width", "70%");
        signup_group.setStyle("width", "75%");
        login_button.setStyle("width", "75%");
    } else {
        signup_form.setStyle("width", "40%");
        signup_group.setStyle("width", "60%");
        login_button.setStyle("width", "60%");
    }
};

//input 선택했을 때
scwin.name_input_onfocus = function (e) {
    name_group.setStyle("border-color", "black");
};

//input border 스타일
scwin.input_onblur = function (e) {
    const currentInputId = e.target.id;
    const targetGroupId = currentInputId.replace("_input", "_group");
    const targetGroup = $p.getComponentById(targetGroupId);

    if (targetGroup) {
        targetGroup.setStyle("border-color", "#DAD3D3");
    }
};

//input border 스타일
scwin.input_onfocus = function (e) {
    const currentInput = e.target;
    const currentInputId = currentInput.id;
    const targetGroupId = currentInputId.replace("_input", "_group");
    const targetGroup = $p.getComponentById(targetGroupId);

    if (targetGroup) {
        targetGroup.setStyle("border-color", "black");
    }
};

//회원가입
scwin.signup_button_onclick = function (e) {
    $p.url("/InsWebApp/websquare/websquare.html?w2xPath=/InsWebApp/ui/auth/signupPage.xml");
};

//비밀번호 찾기
scwin.findPwd_button_onclick = function (e) {
    $c.sbm.execute(sbm_email);
    $p.url("/InsWebApp/websquare/websquare.html?w2xPath=/InsWebApp/ui/auth/findPwdCheckPage.xml");
};

//로그인
scwin.login_button_onclick = function (e) {
    const token = grecaptcha.getResponse();

    if (!token) {
        alert("reCAPTCHA를 먼저 완료해주세요!");
        return;
    }

    const param = {
        secretKey: "6LdornErAAAAAB1vfQLQZu14z0wBg3g2mr-tLJAy",
        token: token
    };
    dma_recaptcha.setJSON(param);
    $c.sbm.execute(sbm_recaptcha);
};

scwin.sbm_login_submitdone = function (e) {
    $p.url("/InsWebApp/websquare/websquare.html?w2xPath=/InsWebApp/ui/user/UserList.xml");
};


scwin.sbm_rechapcher_submitdone = function (e) {
    const responseData = e.responseJSON;

    if(responseData.verified){
        $c.sbm.execute(sbm_login);
    }else{
        $c.win.alert("reCAPTCHA 인증에 실패했습니다. 다시 시도해주세요.");
    }
};


scwin.sbm_recaptcha_submiterror = function (e) {
   const responseData = e.responseJSON;
    console.log(responseData);
};
]]></script>
    	<style type="text/css"><![CDATA[]]></style>
    </head>
    <body ev:onpageload="scwin.onpageload" style="padding: 0;margin: 0;;">
    	<xf:group class="sub_contents" id="" meta_snippetCategory="00_화면시작" meta_snippetKeyComponent="true" meta_snippetName="0_01 페이지시작"
    		style="background-color: #FFF4D6;align-items: center;justify-content: center;display: flex;height: 100%;">

    		<xf:group style="width:41.40%;height:450px;" id="signup_form" class="auth-form">

    			<xf:group style="height:55px;display:flex;flex-direction:row;" id="">


    				<xf:image src="/InsWebApp/images/collabee_icon.jpg" style="width:51px;height:48px;display:flex;" id=""></xf:image>
    				<w2:textbox id="" label="COLLABEE"
    					style="width:150px;height:37px;color: #FFB823;font-size:30px;font-weight: bold;display: flex;">
    				</w2:textbox>
    			</xf:group>


    			<w2:textbox id="" label="쉽고 편하게 사용가능한 COLLABEE 사용하기" style="height: 23px;color: #DAD3D3;"></w2:textbox>
    			<xf:group style="width:60%;height:386px;" id="signup_group" class="signup-group">
    				<xf:group style="height: 60px;" id="">
    					<w2:textbox style="height: 23px;" id="" label="이메일"></w2:textbox>
    					<xf:group class="input-group" id="email_group" style="">
    						<xf:output class="fa-solid fa-envelope auth-icon" id="" label="" style="">
    							<xf:label></xf:label>
    						</xf:output>
    						<xf:input class="input-group-container" id="email_input" placeholder="이메일을 입력하세요"
    							showPlaceHolderOnReadOnly="true" style="" ev:onblur="scwin.input_onblur" ev:onfocus="scwin.input_onfocus"
    							ref="data:dma_login.id">
    						</xf:input>
    					</xf:group>
    				</xf:group>
    				<xf:group id="" style="height: 60px;">
    					<w2:textbox id="" label="비밀번호" style="height: 23px;"></w2:textbox>
    					<xf:group class="input-group" id="password_group" style="">
    						<xf:output class="fa-solid fa-lock auth-icon" id="" label="" style="">
    							<xf:label></xf:label>
    						</xf:output>
    						<xf:secret class="input-group-container" ev:onblur="scwin.input_onblur" ev:onfocus="scwin.input_onfocus"
    							id="password_input" placeholder="비밀번호를 입력하세요" style="" ref="data:dma_login.password">
    						</xf:secret>
    					</xf:group>
    				</xf:group>
    				<w2:span label="Insert Text" style="" id="recaptcha-container"></w2:span>
    			</xf:group>
    			<xf:trigger type="button" style="" id="login_button" class="auth-button" ev:onclick="scwin.login_button_onclick">
    				<xf:label><![CDATA[로그인]]></xf:label>
    			</xf:trigger>
    			<xf:group style="height:54px;" id="" class="button-group">
    				<xf:trigger style="width: 80px;height: 23px;" id="signup_button" type="button" class="login-button" ev:onclick="scwin.signup_button_onclick">
    					<xf:label><![CDATA[회원가입]]></xf:label>
    				</xf:trigger>
    				<xf:trigger style="width:96px;height:23px;" id="findPwd_button" type="button" class="login-button" ev:onclick="scwin.findPwd_button_onclick">
    					<xf:label><![CDATA[비밀번호찾기]]></xf:label>
    				</xf:trigger>
    			</xf:group>
    		</xf:group>
    	</xf:group>
    </body>
</html>
